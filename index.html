<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Undangan Tabligh Akbar Maulid Nabi Muhammad SAW</title>
  <meta name="description" content="Undangan digital untuk Tabligh Akbar Maulid Nabi Muhammad SAW ."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Noto+Naskh+Arabic:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#0b1e2d;       /* deep blue */
      --bg2:#112b3c;       /* blue */
      --accent:#ffd166;    /* gold */
      --accent2:#fca311;   /* warm gold */
      --text:#e9f1f7;      /* off-white */
      --muted:#b5c6d6;     /* muted text */
      --card:#0f2436cc;    /* glass card */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 800px at 70% -10%, #173955 0%, #102738 40%, var(--bg1) 70%) fixed,
                  linear-gradient(180deg, var(--bg2), var(--bg1)) fixed;
      overflow-x:hidden;
    }
    
    /* Music Controls */
    .music-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: rgba(15, 36, 54, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50px;
      padding: 10px 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }
    
    .music-btn {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 20px;
      cursor: pointer;
      transition: transform 0.2s ease;
      padding: 5px;
    }
    
    .music-btn:hover {
      transform: scale(1.1);
    }
    
    .music-btn:active {
      transform: scale(0.95);
    }
    
    .volume-control {
      display: flex;
      align-items: center;
      gap: 8px;
      opacity: 0;
      max-width: 0;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .music-controls:hover .volume-control {
      opacity: 1;
      max-width: 120px;
    }
    
    .volume-slider {
      width: 80px;
      height: 4px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 2px;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }
    
    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
    }
    
    .volume-slider::-moz-range-thumb {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      border: none;
    }
    
    .music-info {
      font-size: 10px;
      color: var(--muted);
      text-align: center;
      margin-top: 3px;
    }
    
    /* Welcome Screen */
    .welcome-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
    
    .welcome-screen.hidden {
      opacity: 0;
      transform: scale(1.1);
      pointer-events: none;
    }
    
    .welcome-content {
      text-align: center;
      padding: 40px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .welcome-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--accent);
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }
    
    .welcome-subtitle {
      color: var(--muted);
      margin-bottom: 30px;
      line-height: 1.6;
    }
    
    .enter-btn {
      background: linear-gradient(135deg, var(--accent2), var(--accent));
      color: #222;
      border: none;
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(255, 193, 102, 0.3);
    }
    
    .enter-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(255, 193, 102, 0.4);
    }
    
    .enter-btn:active {
      transform: translateY(0);
    }
    
    .logos {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 16px;
      background: white;            
      padding: 10px 20px;          
      border-radius: 12px;          
      width: fit-content;
      margin-left: auto;
      margin-right: auto;           /* center di layar */
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* biar ada bayangan */
    }
    .logos img {
        height: 60px; /* bisa disesuaikan */
        object-fit: contain;
    }
    @media (max-width: 600px) {
    .logos img { height: 44px; }
    }
    /* Decorative stars */
    .stars{position:fixed; inset:0; pointer-events:none; z-index:0}
    .star{position:absolute; width:2px; height:2px; background:rgba(255,255,255,.8); border-radius:50%; animation: twinkle 3s infinite ease-in-out}
    @keyframes twinkle{ 0%, 100%{opacity:.2; transform:scale(.7)} 50%{opacity:1; transform:scale(1)} }

    /* Header / Hero */
    header{
      position:relative; z-index:1; padding:64px 16px 24px; text-align:center;
    }
    .badge{display:inline-block; padding:6px 12px; border:1px solid rgba(255,255,255,.2); border-radius:999px; font-size:12px; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); backdrop-filter:blur(6px)}
    h1{
      font-weight:700; font-size:clamp(28px, 6vw, 44px); line-height:1.15; margin:16px auto 8px; max-width:920px;
      text-shadow:0 1px 0 #0008, 0 6px 18px #0006;
    }
    .arabic{font-family:"Noto Naskh Arabic", serif; font-weight:700; font-size:clamp(20px,4.5vw,32px); color:var(--accent); margin-top:6px}
    .subtitle{color:var(--muted); margin:10px auto 0; max-width:760px}

    /* Card */
    .container{width:min(1080px, 94%); margin:24px auto 80px; position:relative; z-index:1}
    .card{background:linear-gradient(180deg, rgba(23,41,61,.5), rgba(10,20,30,.5)); border:1px solid rgba(255,255,255,.12); box-shadow:0 20px 60px #0008; border-radius:24px; overflow:hidden; backdrop-filter: blur(10px)}
    .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:0}
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} }

    .media{position:relative; min-height:280px; background:linear-gradient(135deg,#1b3550,#0e1f30)}
    .media img{width:100%; height:100%; object-fit:cover; display:block; filter:contrast(1.02) saturate(1.05)}
    .media .veil{position:absolute; inset:0; background:linear-gradient(180deg, transparent 50%, rgba(0,0,0,.45));}

    .content{padding:28px 28px 32px 28px}
    .section-title{font-size:14px; letter-spacing:.12em; text-transform:uppercase; color:var(--accent); margin:0 0 8px}
    .lead{font-size:clamp(18px, 2.8vw, 22px); margin:0 0 10px; font-weight:600}
    .muted{color:var(--muted)}

    .meta{display:grid; grid-template-columns: 1fr 1fr; gap:14px; margin:18px 0 22px}
    @media (max-width: 560px){ .meta{grid-template-columns:1fr} }
    .meta .item{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:14px; display:flex; gap:12px; align-items:flex-start}
    .meta .icon{width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg, #203a57, #142636); display:grid; place-items:center; flex:0 0 auto; box-shadow:inset 0 0 0 1px rgba(255,255,255,.06)}

    /* Countdown */
    .countdown{display:flex; gap:12px; flex-wrap:wrap; margin:18px 0}
    .count-box{min-width:90px; text-align:center; padding:12px 10px; background:linear-gradient(180deg, #142739, #0f1f2d); border:1px solid rgba(255,255,255,.12); border-radius:16px; box-shadow:0 10px 24px #0006}
    .count-box .num{font-size: clamp(22px, 5.5vw, 34px); font-weight:700}
    .count-box .lab{font-size:12px; color:var(--muted); letter-spacing:.08em; text-transform:uppercase}

    /* Buttons */
    .actions{display:flex; gap:12px; flex-wrap:wrap; margin-top:20px}
    .btn{appearance:none; border:none; cursor:pointer; padding:12px 16px; border-radius:14px; font-weight:600; transition: transform .15s ease, box-shadow .2s ease; display:inline-flex; align-items:center; gap:10px}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(135deg, var(--accent2), var(--accent)); color:#222; box-shadow:0 10px 24px #0008}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,.18); color:var(--text)}

    /* Footer dua kolom */
    .foot{display:grid; grid-template-columns:1.2fr .8fr; gap:18px}
    @media (max-width: 900px){ .foot{grid-template-columns:1fr} }
    .dua{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:18px}

    /* Animations */
    .fade-in{opacity:0; transform:translateY(12px); animation:fadeUp .9s ease .1s forwards}
    .fade-in-2{opacity:0; transform:translateY(14px); animation:fadeUp .9s ease .25s forwards}
    .fade-in-3{opacity:0; transform:translateY(16px); animation:fadeUp .9s ease .4s forwards}
    @keyframes fadeUp{to{opacity:1; transform:none}}

    .glow{position:relative}
    .glow::after{content:""; position:absolute; inset:-2px; border-radius:inherit; background:radial-gradient(400px 140px at 20% -20%, rgba(255,209,102,.28), transparent 60%), radial-gradient(260px 160px at 120% 120%, rgba(252,163,17,.25), transparent 60%); filter:blur(20px); z-index:-1}

    /* Confetti Canvas */
    #confetti{position:fixed; inset:0; pointer-events:none; z-index:5}

    /* Preloader */
    #preloader{position:fixed; inset:0; background:var(--bg1); display:grid; place-items:center; z-index:999}
    .spinner{width:46px; height:46px; border-radius:50%; border:3px solid rgba(255,255,255,.15); border-top-color:var(--accent); animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .salam {
      padding: 20px;
      background: #0a1a2f; /* biar nyatu sama tema */
      border-radius: 12px;
    }

    .salam h2 {
      color: #ffcc00;
      margin-bottom: 12px;
      text-transform: uppercase;
    }

    .salam p {
      text-align: justify;
      line-height: 1.7;
      font-size: 1rem;
    }
    
    @media (max-width: 600px) {
      .music-controls {
        top: 10px;
        right: 10px;
        padding: 8px 12px;
      }
      
      .welcome-content {
        margin: 20px;
        padding: 30px 20px;
      }
      
      .welcome-title {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <!-- Welcome Screen -->
  <div class="welcome-screen" id="welcomeScreen">
    <div class="welcome-content">
      <div class="welcome-title">üïå Assalamu'alaikum</div>
      <p class="welcome-subtitle">Selamat datang di undangan digital Tabligh Akbar Maulid Nabi Muhammad SAW. Klik tombol di bawah untuk melanjutkan dan menyalakan musik.</p>
      <button class="enter-btn" id="enterBtn">üéµ Masuk Undangan</button>
    </div>
  </div>

  <!-- Music Controls -->
  <div class="music-controls" id="musicControls">
    <button class="music-btn" id="playPauseBtn" title="Play/Pause">‚ñ∂Ô∏è</button>
    <div class="volume-control">
      <span style="font-size: 14px;">üîä</span>
      <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
    </div>
    <div class="music-info">Qolbi Fil Madinah</div>
  </div>

  <!-- Background Stars -->
  <div class="stars" id="stars"></div>
  <canvas id="confetti"></canvas>

  <!-- Preloader -->
  <div id="preloader"><div class="spinner"></div></div>

  <!-- Audio Element -->
  <audio id="bgMusic" loop preload="auto">
    <source src="wwd.mp3juice.blog - QOLBI FIL MADINAH - Maher Zain Harris J Cover By Ai Khodijah (Lirik Musik) (192 KBps).mp3" type="audio/mpeg">
    <!-- Backup audio sources -->
    <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav">
    Browser Anda tidak mendukung pemutar audio.
  </audio>

  <header class="fade-in">
     <div class="logos">
    <img src="paud.png" alt="Logo 1" onerror="this.style.display='none'">
    <img src="yayasan.png" alt="Logo 2" onerror="this.style.display='none'">
    <img src="sdit.png" alt="Logo 3" onerror="this.style.display='none'">
    </div>
    <div class="badge">Undangan Digital</div>
    <h1 class="glow">Tabligh Akbar Maulid Nabi Muhammad SAW</h1>
    <div class="arabic" aria-label="Shalawat">ÿßŸÑŸÑŸëŸ∞ŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸéŸâ ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç</div>
    <p class="subtitle">Assalamu'alaikum warahmatullahi wabarakatuh. </p>
    <p class="subtitle">Dengan memohon rahmat dan ridha Allah Subhanahu wa Ta'ala, kami mengundang Bapak/Ibu/Saudara/i untuk menghadiri acara Tabligh Akbar dalam rangka memperingati Maulid Nabi Muhammad SAW.</p>
  </header>

  <main class="container">
    <div class="card grid fade-in-2">
      <!-- Foto Penceramah / Poster -->
      <figure class="media" aria-label="Foto Penceramah atau Poster Acara">
        <!-- Ganti sumber gambar di bawah ini -->
        <img src="ustad.png" alt="Foto penceramah / poster acara" onerror="this.src='https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=1920&auto=format&fit=crop'">
        <div class="veil"></div>
      </figure>
      <!-- Konten -->
      <div class="content">
        <p class="section-title">Tema</p>
        <p class="lead">"Meneladani Akhlak Nabi Muhammad SAW Sebagai Landasan Pembentukan Karakter Anak"</p>
        <p class="muted">diisi oleh: <strong>Ustadz Dr. H. Firmansyah,M.Pd</strong></p>

        <div class="meta">
          <div class="item">
            <div class="icon">üìÖ</div>
            <div>
              <div><strong>Tanggal & Waktu</strong></div>
              <div id="tanggalText">Sabtu, 13 Rabi'ul Awal 1447 H / 06 September 2025 ‚Ä¢ 07.30 WIB</div>
            </div>
          </div>
          <div class="item">
            <div class="icon">üìç</div>
            <div>
              <div><strong>Lokasi</strong></div>
              <div>Jln Puskesmas Rawat Inap Katibung Dusun Wonodadi Desa Pardasuka Kec. Katibung Kab. Lampung Selatan</div>
            </div>
          </div>
        </div>

        <!-- Countdown -->
        <p class="section-title">Hitung Mundur Acara</p>
        <div class="countdown" id="countdown" data-eventtime="2025-09-06T07:30:00+07:00" aria-live="polite">
          <div class="count-box"><div class="num" id="d">0</div><div class="lab">Hari</div></div>
          <div class="count-box"><div class="num" id="h">0</div><div class="lab">Jam</div></div>
          <div class="count-box"><div class="num" id="m">0</div><div class="lab">Menit</div></div>
          <div class="count-box"><div class="num" id="s">0</div><div class="lab">Detik</div></div>
        </div>

        <div class="actions">
          <a class="btn primary" id="saveCal" href="#" target="_blank" rel="noopener">‚ûï Simpan ke Kalender</a>
          <a class="btn ghost" id="openMap" href="https://maps.app.goo.gl/HBXZB9NbSopVLHBn6" target="_blank" rel="noopener">üó∫Ô∏è Buka Peta</a>
          <button class="btn ghost" id="shareBtn">üì≤ Bagikan</button>
        </div>
      </div>
    </div>

    <div class="foot fade-in-3" style="margin-top:18px">
      <div class="salam">
        <p class="section-title">Salam Pembuka</p>
        <p>Assalamu'alaikum warahmatullahi wabarakatuh.</p>
        <p>Segala puji bagi Allah Subhanahu wa Ta'ala yang telah melimpahkan rahmat, taufik, dan hidayah-Nya kepada kita semua. Shalawat serta salam semoga senantiasa tercurah kepada junjungan kita Nabi Muhammad Shallallahu 'alaihi wasallam, suri teladan sepanjang zaman. Dengan penuh rasa syukur, kami mengundang Bapak/Ibu/Saudara/i untuk menghadiri Tabligh Akbar dalam rangka memperingati Maulid Nabi Muhammad SAW yang insyaAllah akan dilaksanakan di Gedung KB.SDIT Karunia, Jl. Puskesmas Rawat Inap Wonodadi Pardasuka pada:</p>
        <p>üìÖ Sabtu, 6 September 2025</p>
        <p>üï¢ Pukul 07.30 WIB s/d selesai</p>
        <p>Dengan tema: "Meneladani Akhlak Nabi Muhammad SAW sebagai Landasan Pembentukan Karakter Anak"</p>
        <p>Wassalamu'alaikum warahmatullahi wabarakatuh.</p>
      </div>
      <div class="dua">
        <p class="section-title">Catatan</p>
        <ul style="margin:0 0 8px 18px; padding:0">
          <li>Acara ini terbuka untuk umum.</li>
          <li>Diharapkan hadir tepat waktu agar dapat mengikuti rangkaian acara secara utuh.</li>
          <li>Mohon menjaga ketertiban dan kebersihan selama acara berlangsung.</li>
          <li>Berpakaian sopan dan menutup aurat sebagai bentuk penghormatan terhadap majelis ilmu.</li>
        </ul>
      </div>
    </div>
  </main>

  <script>
    // Audio Management Class
    class AudioManager {
      constructor() {
        this.audio = document.getElementById('bgMusic');
        this.playPauseBtn = document.getElementById('playPauseBtn');
        this.volumeSlider = document.getElementById('volumeSlider');
        this.musicControls = document.getElementById('musicControls');
        this.isPlaying = false;
        this.hasStarted = false;
        
        this.init();
      }
      
      init() {
        // Set initial volume
        this.audio.volume = 0.7;
        
        // Event listeners
        this.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
        this.volumeSlider.addEventListener('input', (e) => this.setVolume(e.target.value));
        
        // Audio events
        this.audio.addEventListener('play', () => this.onPlay());
        this.audio.addEventListener('pause', () => this.onPause());
        this.audio.addEventListener('ended', () => this.onEnded());
        this.audio.addEventListener('loadstart', () => console.log('Loading audio...'));
        this.audio.addEventListener('canplaythrough', () => console.log('Audio ready to play'));
        this.audio.addEventListener('error', (e) => this.onError(e));
      }
      
      async play() {
        try {
          await this.audio.play();
          this.isPlaying = true;
          this.hasStarted = true;
          this.playPauseBtn.textContent = '‚è∏Ô∏è';
          this.playPauseBtn.title = 'Pause';
        } catch (error) {
          console.log('Could not play audio:', error);
          this.showAudioError();
        }
      }
      
      pause() {
        this.audio.pause();
        this.isPlaying = false;
        this.playPauseBtn.textContent = '‚ñ∂Ô∏è';
        this.playPauseBtn.title = 'Play';
      }
      
      togglePlayPause() {
        if (this.isPlaying) {
          this.pause();
        } else {
          this.play();
        }
      }
      
      setVolume(value) {
        this.audio.volume = value / 100;
      }
      
      onPlay() {
        this.isPlaying = true;
        this.playPauseBtn.textContent = '‚è∏Ô∏è';
      }
      
      onPause() {
        this.isPlaying = false;
        this.playPauseBtn.textContent = '‚ñ∂Ô∏è';
      }
      
      onEnded() {
        this.isPlaying = false;
        this.playPauseBtn.textContent = '‚ñ∂Ô∏è';
        // Auto replay for looped audio
        setTimeout(() => this.play(), 1000);
      }
      
      onError(e) {
        console.error('Audio error:', e);
        this.showAudioError();
      }
      
      showAudioError() {
        const musicInfo = document.querySelector('.music-info');
        if (musicInfo) {
          musicInfo.textContent = 'Audio tidak tersedia';
          musicInfo.style.color = '#ff6b6b';
        }
      }
    }

    // Welcome Screen Manager
    class WelcomeManager {
      constructor(audioManager) {
        this.audioManager = audioManager;
        this.welcomeScreen = document.getElementById('welcomeScreen');
        this.enterBtn = document.getElementById('enterBtn');
        this.hasEntered = false;
        
        this.init();
      }
      
      init() {
        this.enterBtn.addEventListener('click', () => this.enterInvitation());
        
        // Hide music controls initially
        document.getElementById('musicControls').style.display = 'none';
      }
      
      async enterInvitation() {
        if (this.hasEntered) return;
        this.hasEntered = true;
        
        // Add entrance animation
        this.enterBtn.style.transform = 'scale(0.95)';
        this.enterBtn.textContent = 'üéµ Memulai...';
        
        setTimeout(async () => {
          // Hide welcome screen
          this.welcomeScreen.classList.add('hidden');
          
          // Show music controls
          document.getElementById('musicControls').style.display = 'flex';
          
          // Start audio
          await this.audioManager.play();
          
          // Remove welcome screen after animation
          setTimeout(() => {
            this.welcomeScreen.style.display = 'none';
          }, 800);
        }, 300);
      }
    }

    // Helper: format to Google Calendar link
    function toGCal({title, details, location, startISO, endISO}){
      const base = 'https://calendar.google.com/calendar/render?action=TEMPLATE';
      const dates = `${startISO.replace(/[-:]/g,'').replace('.000','').replace(/\+\d{2}:?\d{2}$/,'Z')}/${endISO.replace(/[-:]/g,'').replace('.000','').replace(/\+\d{2}:?\d{2}$/,'Z')}`;
      const params = new URLSearchParams({
        text: title,
        details,
        location,
        dates
      });
      return `${base}&${params.toString()}`;
    }

    // Initialize everything when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize audio and welcome managers
      const audioManager = new AudioManager();
      const welcomeManager = new WelcomeManager(audioManager);
      
      // Remove preloader
      setTimeout(() => {
        const preloader = document.getElementById('preloader');
        if (preloader) {
          preloader.style.display = 'none';
        }
      }, 300);
      
      // Generate decorative stars
      makeStars();
      
      // Initialize countdown
      initCountdown();
      
      // Initialize other features
      initShareButton();
      initCalendarButton();
    });

    // Decorative Stars generation
    function makeStars(){
      const wrap = document.getElementById('stars');
      const count = 120; // number of stars
      for(let i=0;i<count;i++){
        const s = document.createElement('div');
        s.className='star';
        s.style.left = Math.random()*100+'%';
        s.style.top  = Math.random()*100+'%';
        s.style.animationDelay = (Math.random()*3)+'s';
        s.style.opacity = (0.2+Math.random()*0.8).toFixed(2);
        const size = Math.random()*.7 + .9;
        s.style.transform = `scale(${size})`;
        wrap.appendChild(s);
      }
    }

    // Countdown Logic + Confetti Day
    function initCountdown(){
      const box = document.getElementById('countdown');
      const eventISO = box.dataset.eventtime; // customize date here
      const eventTime = new Date(eventISO).getTime();
      const d = document.getElementById('d');
      const h = document.getElementById('h');
      const m = document.getElementById('m');
      const s = document.getElementById('s');

      function tick(){
        const now = Date.now();
        let diff = Math.max(0, eventTime - now);
        const days = Math.floor(diff / (1000*60*60*24)); diff -= days*(1000*60*60*24);
        const hrs  = Math.floor(diff / (1000*60*60));   diff -= hrs*(1000*60*60);
        const mins = Math.floor(diff / (1000*60));      diff -= mins*(1000*60);
        const secs = Math.floor(diff / 1000);
        d.textContent = days; h.textContent = hrs; m.textContent = mins; s.textContent = secs;

        if(eventTime - now <= 0){
          clearInterval(timer);
          celebrate();
          document.querySelector('.lead').textContent = 'Acara Sedang Berlangsung ‚Äì Ahlan wa sahlan!';
        }
      }
      const timer = setInterval(tick, 1000); tick();
    }

    // Share Button
    function initShareButton(){
      document.getElementById('shareBtn').addEventListener('click', async ()=>{
        const title = 'Tabligh Akbar Maulid Nabi Muhammad SAW';
        const text = 'Ayo hadir dalam Tabligh Akbar: Tema "Meneladani Akhlak Rasulullah". Waktu & lokasi ada di undangan.';
        const url  = location.href;
        if(navigator.share){
          try{ await navigator.share({title, text, url}); }catch(e){}
        }else{
          const wa = `https://wa.me/?text=${encodeURIComponent(`${title}%0A${text}%0A${url}`)}`;
          window.open(wa, '_blank');
        }
      });
    }

    // Calendar Button
    function initCalendarButton(){
      const box = document.getElementById('countdown');
      const start = new Date(box.dataset.eventtime);
      const end = new Date(start.getTime() + 2*60*60*1000); // default duration 2 hours
      const link = toGCal({
        title: 'Tabligh Akbar Maulid Nabi Muhammad SAW',
        details: 'Tema: "Meneladani Akhlak Nabi Muhammad SAW Sebagai Landasan Pembentukan Karakter Anak" - diisi oleh Ustadz Dr. H. Firmansyah,M.Pd',
        location: 'Jln Puskesmas Rawat Inap Katibung Dusun Wonodadi Desa Pardasuka Kec. Katibung Kab. Lampung Selatan',
        startISO: start.toISOString(),
        endISO: end.toISOString()
      });
      const a = document.getElementById('saveCal');
      a.href = link;
    }

    // Simple confetti animation (no library)
    function celebrate(){
      const c = document.getElementById('confetti');
      const ctx = c.getContext('2d');
      let w, h; const DPR = Math.min(2, window.devicePixelRatio || 1);
      function resize(){ w = c.width = innerWidth*DPR; h = c.height = innerHeight*DPR }
      resize(); window.addEventListener('resize', resize);

      const N = 160; const parts=[];
      for(let i=0;i<N;i++){
        parts.push({
          x: Math.random()*w, y: -Math.random()*h/2, r: 3 + Math.random()*6,
          vx: (Math.random()-0.5)*2, vy: 2 + Math.random()*3,
          rot: Math.random()*Math.PI, vr: (Math.random()-0.5)*0.2,
          hue: Math.floor(Math.random()*360)
        });
      }
      let running = true; let start = performance.now();
      (function loop(t){
        if(!running) return; requestAnimationFrame(loop);
        ctx.clearRect(0,0,w,h);
        parts.forEach(p=>{
          p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.vy += 0.02; // gravity
          if(p.y > h+20) { p.y = -10; p.x = Math.random()*w; p.vy = 2 + Math.random()*3 }
          ctx.save();
          ctx.translate(p.x, p.y); ctx.rotate(p.rot);
          ctx.fillStyle = `hsl(${p.hue},85%,60%)`;
          ctx.fillRect(-p.r, -p.r/2, p.r*2, p.r);
          ctx.restore();
        });
        if(t - start > 7000){ running = false; ctx.clearRect(0,0,w,h); }
      })();
    }

    // Handle page visibility change (pause music when tab is not active)
    document.addEventListener('visibilitychange', () => {
      const audioManager = window.audioManager;
      if (audioManager && audioManager.hasStarted) {
        if (document.hidden) {
          if (audioManager.isPlaying) {
            audioManager.wasPlayingBeforeHidden = true;
            audioManager.pause();
          }
        } else {
          if (audioManager.wasPlayingBeforeHidden) {
            audioManager.play();
            audioManager.wasPlayingBeforeHidden = false;
          }
        }
      }
    });

    // Handle audio interruption (phone calls, other apps)
    window.addEventListener('blur', () => {
      const audioManager = window.audioManager;
      if (audioManager && audioManager.isPlaying) {
        audioManager.wasPlayingBeforeBlur = true;
        audioManager.pause();
      }
    });

    window.addEventListener('focus', () => {
      const audioManager = window.audioManager;
      if (audioManager && audioManager.wasPlayingBeforeBlur) {
        setTimeout(() => {
          audioManager.play();
          audioManager.wasPlayingBeforeBlur = false;
        }, 500);
      }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      const audioManager = window.audioManager;
      if (!audioManager || !audioManager.hasStarted) return;
      
      switch(e.code) {
        case 'Space':
          e.preventDefault();
          audioManager.togglePlayPause();
          break;
        case 'ArrowUp':
          e.preventDefault();
          const currentVolume = audioManager.audio.volume * 100;
          const newVolumeUp = Math.min(100, currentVolume + 10);
          audioManager.setVolume(newVolumeUp);
          document.getElementById('volumeSlider').value = newVolumeUp;
          break;
        case 'ArrowDown':
          e.preventDefault();
          const currentVolumeDown = audioManager.audio.volume * 100;
          const newVolumeDown = Math.max(0, currentVolumeDown - 10);
          audioManager.setVolume(newVolumeDown);
          document.getElementById('volumeSlider').value = newVolumeDown;
          break;
      }
    });

    // Smooth scroll for better mobile experience
    document.documentElement.style.scrollBehavior = 'smooth';

    // Handle online/offline status
    window.addEventListener('online', () => {
      console.log('Connection restored');
    });

    window.addEventListener('offline', () => {
      console.log('Connection lost');
    });
  </script>
</body>
</html>